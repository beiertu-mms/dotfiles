"  _   _         __     ___
" | \ | | ___  __\ \   / (_)_ __ ___
" |  \| |/ _ \/ _ \ \ / /| | '_ ` _ \
" | |\  |  __/ (_) \ V / | | | | | | |
" |_| \_|\___|\___/ \_/  |_|_| |_| |_|
"
" Copyright (c) 2021-present Tung Beier
" License: MIT
"
" Neovim documentation https://neovim.io/doc/user/vim_diff.html
" Vim options: http://vimdoc.sourceforge.net/htmldoc/options.html

"==============================================================================
" PLUGINS
"==============================================================================
" auto-install vim-plug
if empty(glob('~/.local/share/nvim/site/autoload/plug.vim'))
  silent !curl -fLo ~/.local/share/nvim/site/autoload/plug.vim --create-dirs
    \ https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
  autocmd!
  autocmd VimEnter * PlugInstall --sync | source ~/.config/nvim/init.vim
endif

call plug#begin('~/.local/share/nvim/plugged')

Plug 'vim-airline/vim-airline'
Plug 'vim-airline/vim-airline-themes'
Plug 'jiangmiao/auto-pairs'
Plug 'norcalli/nvim-colorizer.lua'
Plug 'Shougo/deoplete.nvim', { 'do': ':UpdateRemotePlugins' }
Plug 'glacambre/firenvim', { 'do': { _ -> firenvim#install(0) } }
Plug 'junegunn/fzf.vim'
Plug 'junegunn/fzf', { 'do': { -> fzf#install() } }
Plug 'airblade/vim-gitgutter'
Plug 'fatih/vim-go', { 'branch': 'master' }
Plug 'yggdroot/indentline'
Plug 'joshdick/onedark.vim'
"let g:polyglot_disabled = ['markdown']
Plug 'sheerun/vim-polyglot'
Plug 'tpope/vim-surround'

call plug#end()
"doautocmd User PlugLoaded

" airline
let g:airline_powerline_fonts=1
let g:airline_theme='ayu_mirage'

" colorizer
"set termguicolors
"lua require'colorizer'.setup()

" deoplete
let g:deoplete#enable_at_startup = 1

call deoplete#custom#option('omni_patterns', {
  \ 'go': '[^. *\t]\.\w*',
\})

" vim-og
let g:go_highlight_build_constraints = 1
let g:go_highlight_extra_types = 1
let g:go_highlight_fields = 1
let g:go_highlight_functions = 1
let g:go_highlight_methods = 1
let g:go_highlight_operators = 1
let g:go_highlight_structs = 1
let g:go_highlight_types = 1
let g:go_fmt_command = "goimports"

" netrw - vim internal directory browser
let g:netrw_liststyle = 3     " i: to change view
let g:netrw_banner = 1        " I: to hide banner
let g:netrw_winsize = 20      " set width to n% of the page

" onedark
colorscheme onedark

" firenvim
let g:firenvim_config = {
    \ 'globalSettings': {
        \ 'alt': 'all',
        \ 'cmdlineTimeout': 3000,
    \  },
    \ 'localSettings': {
        \ '.*': {
            \ 'cmdline': 'neovim',
            \ 'content': 'text',
            \ 'priority': 0,
            \ 'selector': 'textarea',
            \ 'takeover': 'never',
        \ },
    \ }
\ }

set guifont=JetBrains_Mono:h14
if exists('g:started_by_firenvim')
    set laststatus=0 lines=25
else
    set laststatus=2
endif

let g:dont_write = v:false
function! My_Write(timer) abort
    let g:dont_write = v:false
    write
endfunction

function! Delay_My_Write() abort
    if g:dont_write
        return
    end
    let g:dont_write = v:true
    call timer_start(10000, 'My_Write')
endfunction

au TextChanged * ++nested call Delay_My_Write()
au TextChangedI * ++nested call Delay_My_Write()

"==============================================================================
" GENERAL
"==============================================================================
set updatetime=100
set completeopt+=noselect

hi Normal guibg=NONE ctermbg=NONE

hi DiffAdd      ctermfg=Green         ctermbg=NONE
hi DiffChange   ctermfg=NONE          ctermbg=NONE
hi DiffDelete   ctermfg=Red           ctermbg=NONE
hi DiffText     ctermfg=Yellow        ctermbg=NONE

set undofile

set number relativenumber
set numberwidth=5
:au VimEnter,InsertLeave * :set relativenumber
":au InsertEnter * :set norelativenumber

set list
set listchars=tab:▸\ ,eol:¬,nbsp:+ " https://vi.stackexchange.com/questions/422/displaying-tabs-as-characters

" Spell checking
" set spelllang=en_us,de_de
" set spell

set expandtab
set smarttab
set shiftwidth=4
set tabstop=4
set softtabstop=4

au BufRead,BufNewFile zathurarc set ft=config
au FileType vim,yml,yaml,toml,json setlocal sw=2 ts=2 sts=2
au FileType cpp setlocal noexpandtab
au FileType go setlocal noexpandtab shiftwidth=4 softtabstop=4 tabstop=4

set autoread

set clipboard=unnamed
set clipboard=unnamedplus

set wildmenu
set wildignore+=*.o,*~,*.pyc,*/out/,*/build/,*/target/

set ruler

set ignorecase
set smartcase

set incsearch
set hlsearch

set lazyredraw

set magic " turn on magic for regex

set showmatch

set noerrorbells
set novisualbell
set t_vb=
set tm=500

set ffs=unix,dos,mac

set nobackup
set nowritebackup
set noswapfile

set linebreak
set textwidth=120

set autoindent
set smartindent
set wrap

set fileformat=unix

set ttimeout
set ttimeoutlen=20
set notimeout

set showcmd
set noshowmode
set autowrite
set path+=**
set shell=/bin/zsh
set ttyfast

set splitbelow splitright

set updatetime=100

set laststatus=2


"==============================================================================
" KEY MAPPINGS
"==============================================================================
let mapleader=","

nmap <leader>s :source ~/.config/nvim/init.vim<CR>

" Moving between splits with Ctrl + vim keys
map <C-j> <C-W>j
map <C-k> <C-W>k
map <C-h> <C-W>h
map <C-l> <C-W>l

" Disable arrow keys
noremap <Up> <NOP>
noremap <Down> <NOP>
noremap <Left> <NOP>
noremap <Right> <NOP>

nnoremap <C-p> :FZF<CR>
nnoremap <C-n> :GFiles<CR>
nnoremap <C-s> :Buffers<CR>

"==============================================================================
" MISCELLANEOUS
"==============================================================================
" ag - the silver searcher
if executable('ag')
  " Prefer over vim grep
  set grepprg=ag\ --nogroup\ --nocolor\ --column
  set grepformat=%f:%l:%c%m
endif

" Delete trailing white spaces on save
function! DeleteTrailingWhiteSpaces()
  exe "normal mz"
  %s/\s\+$//ge
  exe "normal `z"
endfunction

" autocmd BufWrite *.py, *.java, *.h, *.cpp, *.js, *.kt :call DeleteTrailingWhiteSpaces()
