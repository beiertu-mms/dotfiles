#!/usr/bin/env bash
#===============================================================================
#
#          FILE: generate-i3blocks-config
#
#         USAGE: ./generate-i3blocks-config
#
#   DESCRIPTION: Generate the configuration file for i3blocks
#                based on the current host
#
#       OPTIONS: -
#  REQUIREMENTS: cat
#         NOTES: -
#        AUTHOR: tung beier
#       CREATED: 25 August 2020 19:32 CEST
#===============================================================================

set -o errexit  # Exit when a command fails
                # Use || true if a command is allowed to fail
set -o nounset  # Treat unset variables as an error
set -o pipefail # Exit when a command in a pipeline fails

CONFIG_DIR="${HOME}/.config/i3blocks"
CONFIG_FILE="${CONFIG_DIR}/config"
HOST=$(hostname)

#---  SCRIPT LOGIC  ------------------------------------------------------------
# make sure that the configuration directory does exist
if [ ! -d  "$CONFIG_DIR" ]; then
  mkdir -p "$CONFIG_DIR"
fi

# delete old config file
if [ -e "$CONFIG_FILE" ]; then
  rm -f "$CONFIG_FILE"
fi

# base info
  cat <<EOF >> "$CONFIG_FILE"
# i3blocks configuration generated by generate-i3blocks-config script
# -------------------------------------------------------------------
command=/usr/lib/i3blocks/\$BLOCK_NAME
separator_block_width=5
markup=pango
separator=false

[backlight]
command=i3backlight
interval=once
signal=11

[separator]
full_text=Separator
command=i3separator
interval=once

[thermal]
command=i3temp
interval=5

[separator]
full_text=Separator
command=i3separator
interval=once

[volume]
command=i3volume
interval=once
signal=10

[separator]
full_text=Separator
command=i3separator
interval=once

[network]
command=i3network
interval=15

[separator]
full_text=Separator
command=i3separator
interval=once

[disk_usage]
command=i3disk
interval=3600

[separator]
full_text=Separator
command=i3separator
interval=once

EOF

# configuration based on host
case "$HOST" in
  tbe-domdv)
    cat <<EOF >> "$CONFIG_FILE"
[battery]
command=i3battery
interval=60

[separator]
full_text=Separator
command=i3separator
interval=once

EOF
    ;;

  *)
    ;;
esac

  cat <<EOF >> "$CONFIG_FILE"
[time]
command=i3datetime
interval=60

[separator]
full_text=Separator
command=i3separator
interval=once

[keyindicator]
instance=NUM
interval=once
signal=11

EOF

