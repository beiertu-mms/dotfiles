#!/usr/bin/env bash
#===============================================================================
#
#          FILE: system-update.sh
#
#         USAGE: ./system-update.sh
#
#   DESCRIPTION: Run update commands.
#
#  REQUIREMENTS: yay
#        AUTHOR: tung beier
#       CREATED: 28 May 2021 20:29 CEST
#===============================================================================

set -o errexit # Exit when a command fails
# Use || true if a command is allowed to fail
set -o nounset  # Treat unset variables as an error
set -o pipefail # Exit when a command in a pipeline fails

function print() {
	local GREEN='\033[0;32m'
	local NC='\033[0m' # No Color

	echo -e "\n${GREEN}${1}${NC}\n"
}

if command -v gcloud &>/dev/null; then
	print "update gcloud"
	gcloud components update
fi

if command -v ccloud &>/dev/null; then
	print "update ccloud"
	ccloud update
	ccloud completion zsh >~/.config/zsh/completion/_ccloud
fi

if command -v confluent &>/dev/null; then
	print "update confluent"
	confluent update
	confluent completion zsh >~/.config/zsh/completion/_confluent
fi

print "update zsh plugins"
for zsh_plugin_dir in "$HOME"/.local/share/zsh/plugins/*; do
	[[ -d "${zsh_plugin_dir}/.git" ]] || continue

	(
		echo "updating ${zsh_plugin_dir##/} ..."
		cd "$zsh_plugin_dir"
		git pull --ff-only
	)
done
curl -LJO https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/plugins/ssh-agent/ssh-agent.plugin.zsh \
	--output-dir "$HOME/.local/share/zsh/plugins/ssh-agent/"

print "update cheatsheets"
go install github.com/cheat/cheat/cmd/cheat@latest
cheatsheets pull

print "update k8s kind"
go install sigs.k8s.io/kind@latest

print "update pet"
go install github.com/knqyf263/pet@latest

print "update arch"
yay -Syyu

print "done"
